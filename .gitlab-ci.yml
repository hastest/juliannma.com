pages:
  stage: deploy
  image: ruby:2.3
  before_script:
    - apt-get update && apt-get install -y nodejs
    - bundle install
  script:
    - JEKYLL_ENV=production jekyll build -d public/
    - for i in public/images/*; do echo "Removing metadata from $i"; exiftool -geotag= "$i"; done
    - mkdir compressed.public
    - cp -r public/* compressed.public/
    - gzip -r compressed.public
    - cp -r compressed.public/* public/
  artifacts:
    expire_in: 1 days
    paths:
      - public
  only:
    - master
